"use strict";function FormRenderFn(options,element){var utils=fbUtils,formRender=this,defaults={destroyTemplate:!0,container:!1,dataType:"xml",formData:!1,messages:{formRendered:"Form Rendered",noFormData:"No form data.",other:"Other",selectColor:"Select Color"},onRender:function(){},render:!0,notify:{error:function(){},success:function(){},warning:function(){}}},opts=$.extend(!0,defaults,options);!function(){if(!opts.formData)return!1;var e={xml:function(e){return utils.parseXML(e)},json:function(e){return window.JSON.parse(e)}};opts.formData=e[opts.dataType](opts.formData)||!1}(),Element.prototype.appendFormFields=function(e){var t=this;e.forEach(function(e){return t.appendChild(e)})},Element.prototype.emptyContainer=function(){for(var e=this;e.lastChild;)e.removeChild(e.lastChild)};var runCallbacks=function(){opts.onRender&&opts.onRender()},santizeField=function(e){var t=Object.assign({},e);return t.className=e.className||e.class||null,delete t.class,e.values&&(e.values=e.values.map(function(e){return utils.trimObj(e)})),utils.trimObj(t)},rendered=[];if(opts.formData){for(var i=0;i<opts.formData.length;i++){var sanitizedField=santizeField(opts.formData[i]);"date"===sanitizedField.type?sanitizedField.className+=" datetimepicker":"",rendered.push(utils.fieldRender(sanitizedField,opts)),"file"===sanitizedField.type&&$(rendered[i]).find(".suredy-file").data({fileCount:parseInt(sanitizedField.fileCount)||-1,fileType:sanitizedField.fileType||"",view:sanitizedField.view,changeView:eval(sanitizedField.changeView),addFile:eval(sanitizedField.addFile),editable:eval(sanitizedField.editable),download:eval(sanitizedField.download),autoUpload:eval(sanitizedField.autoUpload)}),"date"===sanitizedField.type&&$(rendered[i]).find(".datetimepicker").data({weekstart:parseInt(sanitizedField.weekstart),format:sanitizedField.format||"yyyy-MM-dd",view:sanitizedField.view,manualClose:!!eval(sanitizedField.manualClose)})}if(opts.render){if(opts.container){var renderedFormWrap=utils.markup("div",rendered,{className:"rendered-form"});opts.container=opts.container instanceof jQuery?opts.container[0]:opts.container,opts.container.emptyContainer(),opts.container.appendChild(renderedFormWrap)}else element&&(element.emptyContainer(),element.appendFormFields(rendered));$(".datetimepicker",opts.container||element).each(function(e,t){require(["suredyDatetimepicker"],function(e){e($(t))})}),$(".suredy-file",opts.container||element).each(function(e,t){require(["suredyFile"],function(e){var n=e($(t));n.on("deleted.suredy.filemanager uploaded.suredy.filemanager",function(e,t){var n=$(this),a=n.find('+input[type="hidden"]'),r=a.val(),i="uploaded"===e.type;i?(r&&(r+=","),r+=t.data.id):r&&(r=r.replace(t.data.id+" ",""),r=r.replace(" "+t.data.id,""),r=r.replace(t.data.id,"")),a.val(r)}),n.each(function(t,n){var a=$(n),r=a.find('+input[type="hidden"]').val().replace(/\s/g,",");r&&$.ajax({url:Suredy.ctxp+"/file/list-files",data:{fileIds:r,extendData:""},type:"post",dataType:"json",success:function(t){return t&&t.data?t.success?void $.each(t.data,function(t,n){e.addFile(a,n)}):void $.notify({title:"<b>错误</b><br>",message:"无法加载文件列表，服务器异常！"},{type:"danger"}):void 0},error:function(){$.notify({title:"<b>错误</b><br>",message:"无法加载文件列表，服务器未响应！"},{type:"danger"})}})})})}),runCallbacks(),opts.notify.success(opts.messages.formRendered)}else formRender.markup=rendered.map(function(e){return e.innerHTML}).join("")}else{var noData=utils.markup("div",opts.messages.noFormData,{className:"no-form-data"});rendered.push(noData),opts.notify.error(opts.messages.noFormData)}return formRender}"remove"in Element.prototype||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),"function"!=typeof Event&&!function(){window.Event=function(e){var t=document.createEvent("Event");return t.initEvent(e,!0,!0),t}}(),"function"!=typeof Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(var t=1;t<arguments.length;t++){var n=arguments[t];if(null!=n)for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}),function(e){var t=function(t,n){var a={theme:"fresh",messages:{off:"Off",on:"On"}},r=e.extend(a,n),i=e('<div class="kc-toggle"/>').insertAfter(t).append(t);i.toggleClass("on",t.is(":checked"));var o='<div class="kct-on">'+r.messages.on+"</div>",s='<div class="kct-off">'+r.messages.off+"</div>",l='<div class="kct-handle"></div>',d='<div class="kct-inner">'+o+l+s+"</div>";i.append(d),i.click(function(){t.attr("checked",!t.attr("checked")),e(this).toggleClass("on")})};e.fn.kcToggle=function(n){var a=this;return a.each(function(){var a=e(this);if(!a.data("kcToggle")){var r=new t(a,n);a.data("kcToggle",r)}})}}(jQuery);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fbUtils={};fbUtils.inArray=function(e,t){return-1!==t.indexOf(e)},fbUtils.trimObj=function(e){var t=[null,void 0,"",!1,"false"];for(var n in e)fbUtils.inArray(e[n],t)?delete e[n]:Array.isArray(e[n])&&(e[n].length||delete e[n]);return e},fbUtils.validAttr=function(e){var t=["values","enableOther","other","label","subtype"];return!fbUtils.inArray(e,t)},fbUtils.attrString=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&fbUtils.validAttr(n)&&(n=fbUtils.safeAttr(n,e[n]),t.push(n.name+n.value));return t.join(" ")},fbUtils.safeAttr=function(e,t){e=fbUtils.safeAttrName(e);var n=void 0;return t&&(Array.isArray(t)?n=fbUtils.escapeAttr(t.join(" ")):("boolean"==typeof t&&(t=t.toString()),n=fbUtils.escapeAttr(t.replace(","," ").trim()))),t=t?'="'+n+'"':"",{name:e,value:t}},fbUtils.safeAttrName=function(e){var t={className:"class"};return t[e]||fbUtils.hyphenCase(e)},fbUtils.hyphenCase=function(e){return e=e.replace(/[^\w\s\-]/gi,""),e=e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()}),e.replace(/\s/g,"-").replace(/^-+/g,"")},fbUtils.camelCase=function(e){return e.replace(/-([a-z])/g,function(e,t){return t.toUpperCase()})},fbUtils.markup=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=void 0,r=document.createElement(e),i=function(e){return Array.isArray(e)?"array":"undefined"==typeof e?"undefined":_typeof(e)},o={string:function(e){r.innerHTML=e},object:function(e){return r.appendChild(e)},array:function(e){for(var t=0;t<e.length;t++)a=i(e[t]),o[a](e[t])}};for(var s in n)if(n.hasOwnProperty(s)){var l=fbUtils.safeAttrName(s);r.setAttribute(l,n[s])}return a=i(t),t&&o[a].call(this,t),r},fbUtils.parseAttrs=function(e){var t=e.attributes,n={};return fbUtils.forEach(t,function(e){var a=t[e].value;a.match(/false|true/g)?a="true"===a:a.match(/undefined/g)&&(a=void 0),a&&(n[t[e].name]=a)}),n},fbUtils.parseOptions=function(e){var t=e.getElementsByTagName("option"),n={},a=[];if(t.length)for(var r=0;r<t.length;r++)n=fbUtils.parseAttrs(t[r]),n.label=t[r].textContent,a.push(n);return a},fbUtils.parseXML=function(e){var t=new window.DOMParser,n=t.parseFromString(e,"text/xml"),a=[];if(n)for(var r=n.getElementsByTagName("field"),i=0;i<r.length;i++){var o=fbUtils.parseAttrs(r[i]),s=r[i].children||[];s.length&&(o.values=fbUtils.parseOptions(r[i])),a.push(o)}return a},fbUtils.escapeHtml=function(e){var t=document.createElement("textarea");return t.textContent=e,t.innerHTML},fbUtils.escapeAttr=function(e){function t(e){return n[e]||e}var n={'"':"&quot;","&":"&amp;","<":"&lt;",">":"&gt;"};return"string"==typeof e?e.replace(/["&<>]/g,t):e},fbUtils.escapeAttrs=function(e){for(var t in e)e.hasOwnProperty(t)&&(e[t]=fbUtils.escapeAttr(e[t]));return e},fbUtils.forEach=function(e,t,n){for(var a=0;a<e.length;a++)t.call(n,a,e[a])},fbUtils.unique=function(e){return e.filter(function(e,t,n){return n.indexOf(e)===t})},fbUtils.fieldRender=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!1,a="",r="",i="",o=e.label||"",s=e.description||"",l="",d=e.values;e.name=n?e.name+"-preview":e.name,e.id=e.name,e.name=e.multiple?e.name+"[]":e.name,e.type=e.subtype||e.type,e.required&&(e.required=null,e["aria-required"]="true",l='<span class="required">*</span>'),"hidden"!==e.type&&(s&&(s='<span class="tooltip-element" tooltip="'+s+'">?</span>'),r='<label for="'+e.id+'" class="fb-'+e.type+"-label"+("checkbox"!==e.type?" input-group-addon":"")+'">'+o+" "+l+" "+s+"</label>",("checkbox-group"===e.type||"radio-group"===e.type)&&(r="")),"date"===e.type&&(e.readonly="readonly");var c=e.label;delete e.label,delete e.description;var u=fbUtils.attrString(e);switch(e.type){case"textarea":case"rich-text":delete e.type;var p=e.value||"";a=r+"<textarea "+u+">"+p+"</textarea>",a='<div class="input-group">'+a+"</div>";break;case"select":var f;if(e.type=e.type.replace("-group",""),d){e.placeholder&&(i+="<option disabled selected>"+e.placeholder+"</option>");for(var m=0;m<d.length;m++)(!d[m].selected||e.placeholder)&&delete d[m].selected,d[m].label||(d[m].label=""),f=fbUtils.attrString(d[m]),i+="<option "+f+">"+d[m].label+"</option>"}a=r+"<select "+u+">"+i+"</select>",a='<div class="input-group">'+a+"</div>";break;case"checkbox-group":case"radio-group":var v=void 0;if(e.type=e.type.replace("-group",""),"checkbox"===e.type&&(e.name=e.name+"[]"),d){for(var y=void 0,b=0;b<d.length;b++)v=Object.assign({value:"",label:""},e,d[b]),v.selected&&(delete v.selected,v.checked=null),v.id=e.id+"-"+b,y=fbUtils.attrString(v),i+="<input "+y+' /> <label for="'+v.id+'">'+v.label+"</label>";if(e.other){var g={id:e.id+"-other",className:e.className+" other-option",onclick:"fbUtils.otherOptionCB('"+e.id+"-other')"};y=fbUtils.attrString(Object.assign({},e,g)),i+="<input "+y+' /> <label for="'+g.id+'">'+t.messages.other+'</label> <input type="text" name="'+e.name+'" id="'+g.id+'-value" style="display:none;" />'}}a=r+'<div class="'+e.type+'-group">'+i+"</div>";break;case"text":case"password":case"email":case"number":case"file":case"hidden":case"date":case"tel":case"autocomplete":a=r+" <input "+u+">","file"===e.type&&(a=r+'<div class="form-control" style="height: auto;"><div class="suredy-file"></div> <input '+u+"></div>",a=a.replace(/type\="file"/,'type="hidden"')),"date"===e.type&&(a+='<div class="input-group-addon"><i class="icon-calendar"></i></div>',a=a.replace(/type\="date"/,'type="text"')),a='<div class="input-group">'+a+"</div>";break;case"color":a=r+" <input "+u+"> "+t.messages.selectColor,a='<div class="input-group">'+a+"</div>";break;case"button":case"submit":a="<button "+u+">"+c+"</button>",a='<div class="input-group">'+a+"</div>";break;case"checkbox":a="<input "+u+"> "+r,e.toggle&&setTimeout(function(){$(document.getElementById(e.id)).kcToggle()},100);break;default:a="<"+e.type+" "+u+">"+c+"</"+e.type+">",a='<div class="input-group">'+a+"</div>"}if("hidden"!==e.type){var h=e.id?"fb-"+e.type+" form-group field-"+e.id:"";h+="half"===e.colWidth?" col-md-6":"big-small"===e.colWidth?" col-md-8":"small"===e.colWidth?" col-md-4":" col-md-12",a=fbUtils.markup("div",a,{className:h})}else a=fbUtils.markup("input",null,e);return a},fbUtils.otherOptionCB=function(e){var t=document.getElementById(e),n=document.getElementById(e+"-value");t.checked?(t.style.display="none",n.style.display="inline-block"):(t.style.display="inline-block",n.style.display="none")},fbUtils.capitalize=function(e){return e.replace(/\b\w/g,function(e){return e.toUpperCase()})},function(e){e.fn.formRender=function(e){this.each(function(){var t=new FormRenderFn(e,this);return t})}}(jQuery);